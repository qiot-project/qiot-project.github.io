<!DOCTYPE html>

<html>

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>
    PoC Edge Manufacturing - QIoT project
    
  </title>

  <meta name="description" content="The team has been listening to the Market needs and investments for quite a few months recently. In addition to that, we tried to understand what is the main...">

  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="/assets/vendor/bootstrap/css/bootstrap.min.css">

  <link rel="stylesheet" href="/assets/vendor/fontawesome-free/css/all.min.css">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="/blog/usecase-manufacturing/">
  <link rel="alternate" type="application/rss+xml" title="QIoT project" href="/feed.xml">

  
    
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-SK96X617FT"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'G-SK96X617FT');
  </script>

  

</head>


<body>

  <!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="/">QIoT project</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fa fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
<!--         <li class="nav-item"> -->
<!--           <a class="nav-link" href="/">Home</a> -->
<!--         </li> -->
        <li class="nav-item">
          <a class="nav-link" href="/announcements">Announcements</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/usecases">Use Cases</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/projects">Projects</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/blog">Blog</a>
        <li class="nav-item">
          <a class="nav-link" href="/community">Community</a>
        </li>
      </ul>
      </ul>
    </div>
  </div>
</nav>

  <!-- Page Header -->

<header class="masthead" style="background-image: url('/assets/images/posts/usecase-manufacturing/hardware_landscape.jpg')">
  
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <div class="col-lg-16 col-md-10 mx-auto">
          <div class="post-heading">
            <h1>PoC Edge Manufacturing</h1>
            
            <h2 class="subheading">Use-case overview</h2>
            
            <span class="meta">
            
            
			  
			     
			        
			            <img class="headshot" src="https://www.gravatar.com/avatar/58d8a28d588d957040fd5288cc208a41">
			        
			            <a href="#">Posted by Andrea Battaglia</a>
			    
			    on September 20, 2021 &middot; <span class="reading-time" title="Estimated read time">
  
   39 mins  read </span>
            
            </span>
            <br>
            <span class="meta">
			  
            </span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="row">
      <div class="col-lg-16 col-md-10 mx-auto">

        <div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#intro">Intro</a>
<ul class="sectlevel1">
<li><a href="#main-diagram">Main Diagram</a></li>
</ul>
</li>
<li><a href="#the-machinery-edge-device">The Machinery (edge device)</a>
<ul class="sectlevel1">
<li><a href="#hardware">Hardware</a></li>
<li><a href="#main-diagram-2">Main Diagram</a></li>
<li><a href="#operating-system">Operating System</a></li>
<li><a href="#container-technology">Container technology</a></li>
<li><a href="#machinery-service">Machinery service</a></li>
</ul>
</li>
<li><a href="#the-factory-edge-server">The Factory (Edge Server)</a>
<ul class="sectlevel1">
<li><a href="#hardware-2">Hardware</a></li>
<li><a href="#main-diagram-3">Main Diagram</a></li>
<li><a href="#platform">Platform</a></li>
<li><a href="#software-infrastructure-components">Software infrastructure components</a>
<ul class="sectlevel2">
<li><a href="#broker-service">Broker service</a></li>
<li><a href="#cert-manager-service-issuer">Cert-manager service (issuer)</a></li>
<li><a href="#sql-storage">SQL Storage</a></li>
<li><a href="#nosql-storage">NoSQL Storage</a></li>
</ul>
</li>
<li><a href="#business-logic-implementation">Business Logic implementation</a>
<ul class="sectlevel2">
<li><a href="#facility-manager">Facility Manager</a></li>
<li><a href="#product-line-service">Product-Line service</a></li>
<li><a href="#production-validator-service">Production Validator service</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#datacenter">Datacenter</a>
<ul class="sectlevel1">
<li><a href="#main-diagram-4">Main Diagram</a></li>
<li><a href="#platform-architecture">Platform architecture</a>
<ul class="sectlevel2">
<li><a href="#red-hat-openshift-container-platform">Red Hat Openshift Container Platform</a></li>
</ul>
</li>
<li><a href="#software-infrastructure-components-2">Software infrastructure components</a>
<ul class="sectlevel2">
<li><a href="#stream-service">Stream service</a></li>
<li><a href="#timeseries-storage">Timeseries Storage</a></li>
<li><a href="#sql-storage-2">SQL Storage</a></li>
<li><a href="#nosql-storage-2">NoSQL Storage</a></li>
<li><a href="#cert-manager-service">Cert-manager service</a></li>
</ul>
</li>
<li><a href="#business-logic-implementations">Business Logic implementations</a>
<ul class="sectlevel2">
<li><a href="#registration-service">Registration service</a></li>
<li><a href="#plant-manager-service">Plant Manager service</a></li>
<li><a href="#global-product-line-service">Global Product-line service</a></li>
<li><a href="#event-collector-service">Event Collector service</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="paragraph">
<p>The team has been listening to the Market needs and investments for quite a few months recently.
In addition to that, we tried to understand what is the main trend in the innovation space, as well as the latest and greatest in terms of new projects and customer requests.</p>
</div>
<div class="paragraph">
<p>It came out that the manufacturing vertical is currently most invested vertical and we decided to try to address some common issues and questions regarding the architectural design and the most important collaterals such as security, workload distribution, connectivity and so on so forth.</p>
</div>
<h1 id="intro" class="sect0"><a class="anchor" href="#intro"></a>Intro</h1>
<div class="paragraph">
<p>The main goal is to build an environmental network of machineries producing goods intended for the global market.</p>
</div>
<div class="paragraph">
<p>The machineries (edge devices) belong to a facility network environment identified as Factory (Edge Server). The factories are managed by the central plant manager, identified as Datacenter.</p>
</div>
<div class="paragraph">
<p>To be specific, the machineries produce t-shirts.</p>
</div>
<div class="paragraph">
<p>The item production is based on a <strong>production model</strong> (a.k.a. <em>Product Line</em>) and consists of <strong>four production stages</strong>, each and every of subject to validation against a 3rd party entity living on the Factory layer.</p>
</div>
<div class="paragraph">
<p>If the validation process returns a negative outcome, the item is marked as discarded and it&#8217;s production process is interrupted.</p>
</div>
<div class="paragraph">
<p>Each and every stage production and the related validation are documented through telemetry sends to the plant manager.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/usecase-manufacturing/use-case-overview.png" alt="use case overview" width="100%">
</div>
</div>
<div class="sect1">
<h2 id="main-diagram"><a class="anchor" href="#main-diagram"></a>Main Diagram</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/usecase-manufacturing/architecture/overview.png" alt="overview" width="100%">
</div>
</div>
</div>
</div>
<h1 id="the-machinery-edge-device" class="sect0"><a class="anchor" href="#the-machinery-edge-device"></a>The Machinery (edge device)</h1>
<div class="paragraph">
<p>The software running on the edge device has the purpose of emulating a machinery producing T-shirts based on the production model provided by the factory controller.</p>
</div>
<div class="paragraph">
<p>The business logic of the Machinery has been entirely implemented using cloud-native frameworks and packaged using container technologies.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/usecase-manufacturing/machinery-marketing.png" alt="machinery marketing" width="100%">
</div>
</div>
<div class="sect1">
<h2 id="hardware"><a class="anchor" href="#hardware"></a>Hardware</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Hardware of choice for the edge device is the Compulab Fitlet2.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/usecase-manufacturing/fitlet2.jpg" alt="fitlet2" width="100%">
</div>
</div>
<div class="paragraph">
<p>The FITLET2-CE3930 is equipped with Intel® Atom X5-E3930 powered by Intel®.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Model</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FITLET2-CE3930-P36</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fan / Fanless</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fanless</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intel® Atom x5-3930</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RAM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1x 2Gb SO-DIMM 204-pin DDR3L Non-ECC DDR3L-1866 (1.35V)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dual head: mini DP 1.2 4K @ 60 Hz; HDMI 1.4 4K @ 30 Hz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WIFI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">802.11ac dual antenna + BT 4.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ethernet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 GbE ports on-board</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">USB 2.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 USB ports on-board: 2x USB 3.0 + 2x USB 2.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Audio</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stereo line out Realtek ALC1150 audio codec</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serial Port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RS232 mini-serial</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BIOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AMI Aptio V</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input voltage range</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Up to DC 9V – 36V*</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operating system support</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">all</p></td>
</tr>
</tbody>
</table>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/usecase-manufacturing/fitlet2-block-diagram.png" alt="fitlet2 block diagram" width="100%">
</div>
</div>
<div class="paragraph">
<p>Additional technical detail can be found at the following link: <a href="https://fit-iot.com/web/products/fitlet2/fitlet2-specifications/">link</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="main-diagram-2"><a class="anchor" href="#main-diagram-2"></a>Main Diagram</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/usecase-manufacturing/architecture/edge.png" alt="edge" width="50%">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="operating-system"><a class="anchor" href="#operating-system"></a>Operating System</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/usecase-manufacturing/brand/Logo-Red_Hat-Edge-A-Standard-RGB.png" alt="Logo Red Hat Edge A Standard RGB" width="20%">
</div>
</div>
<div class="paragraph">
<p>In an edge computing solution, the operating system is required to be efficient, lightweight and mature.
The team focused on the most efficient enterprise-grade solution on the marker, which guarantees security, performance, and container-native solutions.
Below a list of the principal, compulsory features we&#8217;ve been looking for in an operating system:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Must be fully-fledged 64 bit OS (not just its kernel);</p>
</li>
<li>
<p>Must have a very small memory footprint;</p>
</li>
<li>
<p>Must be immutable or, at least, modular;</p>
</li>
<li>
<p>Must have the ability to run a container engine with the minimum memory footprint, like Podman or CRI-O;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The most suitable and appropriate operating system, also certified on the target hardware is <a href="https://www.redhat.com/en/resources/linux-for-edge-datasheet">Red Hat Enterprise Linux for Edge (RHEL for Edge)</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="container-technology"><a class="anchor" href="#container-technology"></a>Container technology</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/usecase-manufacturing/brand/podman-logo.png" alt="podman logo" width="15%">
</div>
</div>
<div class="paragraph">
<p>Podman is a daemonless, open source, Linux-native tool designed to develop, manage, and run Open Container Initiative (OCI) containers and pods.</p>
</div>
<div class="paragraph">
<p>It has a similar directory structure to Buildah, Skopeo, and CRI-O.</p>
</div>
<div class="paragraph">
<p>Podman doesn&#8217;t require an active container engine for its commands to work.</p>
</div>
<div class="paragraph">
<p>Last but not least, Podman is available in the standard rpm library of RHEL, so you get full support on it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="machinery-service"><a class="anchor" href="#machinery-service"></a>Machinery service</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="/assets/images/logo/logo-quarkus.png" alt="logo quarkus" width="10%">
</div>
</div>
<div class="paragraph">
<p>It&#8217;s implemented on top of the <a href="https://quarkus.io/">Quarkus</a> framework and runs in <a href="https://quarkus.io/guides/building-native-image">native mode</a> on a container environment.</p>
</div>
<div class="paragraph">
<p>The Machinery service is the core service of the edge device and implemented on top of the <a href="https://quarkus.io/">Quarkus framework</a>. The service is compiled in native mode using <a href="https://developers.redhat.com/blog/2021/04/14/mandrel-a-specialized-distribution-of-graalvm-for-quarkus">MandrelVM</a> to run natively into a container (possible on 64bit OS only!)</p>
</div>
<div class="paragraph">
<p>Moreover, the Machinery service is designed and implemented to have the smallest memory footprint as possible and perform the transactions with the API exposed by the Factory in the shortest time. The native mode dramatically improves the performance and guarantees the full compatibility with the OCI standards and the Podman engine.</p>
</div>
<div class="paragraph">
<p>The Machinery service is responsible for the emulation of a machinery producing T-shirts. The production process goes through four different stages each of the managed by a conveyor belt.</p>
</div>
<div class="paragraph">
<p>The production stages are enumerated <a href="https://raw.githubusercontent.com/qiot-project/qiot-manufacturing-all-domainmodel/main/src/main/java/io/qiot/manufacturing/all/commons/domain/production/ProductionChainStageEnum.java">here</a> and can be listed as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WEAVING</p>
</li>
<li>
<p>COLORING</p>
</li>
<li>
<p>PRINTING</p>
</li>
<li>
<p>PACKAGING</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each and every production stage generates a set of random numbers representing what&#8217;s been produced and that outcome is added to the Item data object and sent to the <a href="#production-validator-service">Production Validator service</a> (Factory layer) for validation.</p>
</div>
<div class="paragraph">
<p>The Machinery service starts the production of a new T-shirt every 2 seconds and the execution of each and stage job takes a random amount of time between 1 and 2 seconds. The team is open to thoughts and suggestions about the opportunity/need to make that timeframe variable for performance testing purposes.</p>
</div>
<div class="paragraph">
<p>More details can be found in the <a href="https://github.com/qiot-project/qiot-manufacturing-edge-machinery">dedicated repository</a>.</p>
</div>
</div>
</div>
<h1 id="the-factory-edge-server" class="sect0"><a class="anchor" href="#the-factory-edge-server"></a>The Factory (Edge Server)</h1>
<div class="sect1">
<h2 id="hardware-2"><a class="anchor" href="#hardware-2"></a>Hardware</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Edge Server is based on the powerful Intel® NUC 10 Performance kit - NUC10i7FNH.</p>
</div>
<div class="paragraph">
<p>The Intel® NUC guarantees performance and stability to the container platform designed to control the facility and the machineries.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/usecase-manufacturing/NUC.jpg" alt="NUC" width="100%">
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Product Collection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intel® NUC Kit with 10th Generation Intel® Core™ Processors</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Board Number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NUC10i7FNB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Board Form Factor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UCFF (4" x 4")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Socket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Soldered-down BGA</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"># of Cores</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"># of Threads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor Base Frequency</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.10 GHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max Turbo Frequency</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.70 GHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RAM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DDR4-2666 1.2V SO-DIMM</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Internal Drive Form Factor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">M.2 and 2.5" Drive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">M.2 256Gb</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lithography</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14 nm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14 nm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lithography</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25 W</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DC Input Voltage Supported</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">19 VDC</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Additional technical detail can be found at the following link: <a href="https://www.intel.com/content/www/us/en/products/sku/188811/intel-nuc-10-performance-kit-nuc10i7fnh/specifications.html">link</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="main-diagram-3"><a class="anchor" href="#main-diagram-3"></a>Main Diagram</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/usecase-manufacturing/architecture/factory.png" alt="factory" width="100%">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="platform"><a class="anchor" href="#platform"></a>Platform</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="/assets/images/logo/Logo-Red_Hat-OpenShift-A-Standard-RGB.png" alt="Logo Red Hat OpenShift A Standard RGB" width="20%">
</div>
</div>
<div class="paragraph">
<p>Red Hat has worked a lot to make OpenShift footprint smaller to fit into more constrained environments by putting both control and worker capabilities into a single node.</p>
</div>
<div class="paragraph">
<p>Thanks to the capabilities and functionalities of Single Node Openshift (SNO) it is now possible to leverage the overall factory management and automation with less reaources and dedicate at scale dedicated business logic to the scale of the production facilities in a secured fashion.</p>
</div>
<div class="paragraph">
<p>The team is keen to provide a detailed walkthrough about How to install SNO on 10th gen NUC <a href="https://qiot-project.github.io/blog/sno-on-nuc10/">here</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="software-infrastructure-components"><a class="anchor" href="#software-infrastructure-components"></a>Software infrastructure components</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="broker-service"><a class="anchor" href="#broker-service"></a>Broker service</h3>
<div class="imageblock">
<div class="content">
<img src="/assets/images/logo/Logo-Red_Hat-AMQ-A-Standard-RGB.png" alt="Logo Red Hat AMQ A Standard RGB" width="20%">
</div>
</div>
<div class="paragraph">
<p>A-MQ Broker is a pure-Java multiprotocol message broker. It’s built on an efficient, asynchronous core with a fast native journal for message persistence and the option of shared-nothing state replication for high availability.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Persistence - A fast, native-IO journal or a JDBC-based store</p>
</li>
<li>
<p>High availability - Shared store or shared-nothing state replication</p>
</li>
<li>
<p>Advanced queueing - Last value queues, message groups, topic hierarchies, and large message support</p>
</li>
<li>
<p>Multiprotocol - AMQP 1.0, MQTT, STOMP, OpenWire, and HornetQ Core</p>
</li>
<li>
<p>Integration - Full integration with Red Hat JBoss EAP</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A-MQ Broker is based on the <a href="https://activemq.apache.org/artemis/">Apache ActiveMQ Artemis</a> project.</p>
</div>
<div class="paragraph">
<p>The broker service exposes the endpoint for the stage production telemetry coming from the machineries running on the edge devices. The endpoint is exposed through the <a href="https://activemq.apache.org/components/artemis/documentation/latest/openwire.html">Openwire protocol</a>, protocol of choice for the implementation of transactional asynchronous architectures.</p>
</div>
<div class="paragraph">
<p>The broker offers dedicated queues for the production telemetry coming from the machineries and creates dedicated queues for the validation response from the validation service. More in detail, the broker service creates one queue for each and every machinery service awaiting for validation responses.
Technical details about the telemetry and the endpoints to be given in the next chapters.</p>
</div>
</div>
<div class="sect2">
<h3 id="cert-manager-service-issuer"><a class="anchor" href="#cert-manager-service-issuer"></a>Cert-manager service (issuer)</h3>
<div class="imageblock">
<div class="content">
<img src="/assets/images/logo/logo-cert-manager.png" alt="logo cert manager" width="10%">
</div>
</div>
<div class="paragraph">
<p>Cert-manager automates certificate management in cloud native environments and thus helped with the implementation of a dynamic certificate provisioning for edge devices</p>
</div>
<div class="paragraph">
<p>Cert-manager builds on top of Kubernetes, introducing certificate authorities and certificates as first-class resource types in the Kubernetes API.</p>
</div>
<div class="paragraph">
<p>This makes it possible to provide 'certificates as a service' to developers working within your Kubernetes cluster.</p>
</div>
<div class="paragraph">
<p>Highlights:
Provide easy to use tools to manage certificates.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A standardised API for interacting with multiple certificate authorities (CAs).</p>
</li>
<li>
<p>Gives security teams the confidence to allow developers to self-server certificates.</p>
</li>
<li>
<p>Support for ACME (Let’s Encrypt), HashiCorp Vault, Venafi, self signed and internal certificate authorities.</p>
</li>
<li>
<p>Extensible to support custom, internal or otherwise unsupported CAs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In our design, the issuer provides service (runtime) certificates to all the devices managed by the single factory. In order to achieve the above, the the factory performs the following actions at its bootstrap time:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The Factory registarts itself against the production plant.</p>
</li>
<li>
<p>In case of registration successful, the factory receives a unique certificate for the factory; The certificate will have the form od a Delegate CA</p>
</li>
<li>
<p>The Factory asks cert manager to instantiate a Delegate certificate Issuer using the above delegate certificate authority as a root certificate.</p>
</li>
<li>
<p>The factory will issue runtime certificate to the edge devices registering against the factory using the newly created issuer</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="sql-storage"><a class="anchor" href="#sql-storage"></a>SQL Storage</h3>
<div class="imageblock">
<div class="content">
<img src="/assets/images/logo/logo-postgresql.png" alt="logo postgresql" width="10%">
</div>
</div>
<div class="paragraph">
<p>PostgreSQL is a powerful, open source object-relational database system with over 30 years of active development that has earned it a strong reputation for reliability, feature robustness, and performance.</p>
</div>
<div class="paragraph">
<p>The relational database engine is used to store non-timeseries data like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Machinery data</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>More about PostgreSQL can be found <a href="https://www.postgresql.org/">here</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="nosql-storage"><a class="anchor" href="#nosql-storage"></a>NoSQL Storage</h3>
<div class="imageblock">
<div class="content">
<img src="/assets/images/logo/logo-mongodb.png" alt="logo mongodb" width="30%">
</div>
</div>
<div class="paragraph">
<p>MongoDB’s document data model naturally supports JSON and its expressive query language is simple for developers to learn and use. Functionality such as automatic failover, horizontal scaling, and the ability to assign data to a location are built-in.</p>
</div>
<div class="paragraph">
<p>The nosql database service is helpful when it comes to store, query and retrieve structured data sets like the json version of the <a href="https://github.com/qiot-project/qiot-manufacturing-factory-domainmodel/blob/main/src/main/java/io/qiot/manufacturing/factory/commons/domain/productline/ProductLineDTO.java">Product Line</a> model.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="business-logic-implementation"><a class="anchor" href="#business-logic-implementation"></a>Business Logic implementation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="facility-manager"><a class="anchor" href="#facility-manager"></a>Facility Manager</h3>
<div class="imageblock">
<div class="content">
<img src="/assets/images/logo/logo-quarkus.png" alt="logo quarkus" width="10%">
</div>
</div>
<div class="paragraph">
<p>It&#8217;s implemented on top of the <a href="https://quarkus.io/">Quarkus</a> framework and runs in <a href="https://quarkus.io/guides/building-native-image">native mode</a> on a container environment.</p>
</div>
<div class="paragraph">
<p>The Facility Manager service is the core service of the factory layer.</p>
</div>
<div class="paragraph">
<p>It is responsible for the management of the following entities in the facility:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The factory;</p>
</li>
<li>
<p>The machineries;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The machinery service also covers a few operational functionalities like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Device subscription (pass-through);</p>
</li>
<li>
<p>Certificates distribution (pass-through);</p>
</li>
<li>
<p>Factory ID provider for all the services belonging to the same layer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At bootstrap time, the Facility Manager subscribes to the Central subscription system on the datacenter, providing its identity info (<strong>Serial ID</strong> and <strong>Name</strong>). it will receive, in turn, a unique ID (in a format of a UUID) that each and every service running on the factory layer will use when connecting to the services running on the datacenter.</p>
</div>
<div class="paragraph">
<p>The response from the Plant Manager service will also contain the certificates used for mutual authentication against services running on the datacenter.</p>
</div>
<div class="paragraph">
<p>The specs of the services exposed by the Facility Manager service can be found into the dedicated section.</p>
</div>
<div class="paragraph">
<p>More details can be found in the <a href="https://github.com/qiot-project/qiot-manufacturing-factory-facility-manager">dedicated repository</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="product-line-service"><a class="anchor" href="#product-line-service"></a>Product-Line service</h3>
<div class="imageblock">
<div class="content">
<img src="/assets/images/logo/logo-quarkus.png" alt="logo quarkus" width="10%">
</div>
</div>
<div class="paragraph">
<p>It&#8217;s implemented on top of the <a href="https://quarkus.io/">Quarkus</a> framework and runs in <a href="https://quarkus.io/guides/building-native-image">native mode</a> on a container environment.</p>
</div>
<div class="paragraph">
<p>The Product-line service is responsible for transforming the <a href="https://raw.githubusercontent.com/qiot-project/qiot-manufacturing-datacenter-domainmodel/main/src/main/java/io/qiot/manufacturing/datacenter/commons/domain/productline/GlobalProductLineDTO.java">Global Product-line</a> into a model that supposed to be consumed by the Machineries.</p>
</div>
<div class="paragraph">
<p>The transformation phase consists of a few simple steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Consumes the latest product line available from the Streaming service running on the Datacenter;</p>
</li>
<li>
<p>Applies <a href="https://raw.githubusercontent.com/qiot-project/qiot-manufacturing-datacenter-domainmodel/main/src/main/java/io/qiot/manufacturing/datacenter/commons/domain/productline/MarginsDTO.java">Margins</a> to the basic values contained into the product line data object;</p>
</li>
<li>
<p>Stores the <a href="https://raw.githubusercontent.com/qiot-project/qiot-manufacturing-factory-domainmodel/main/src/main/java/io/qiot/manufacturing/factory/commons/domain/productline/ProductLineDTO.java">outcome</a> of the previous phase into the SQL database for future distribution.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The main goal of the above functionality is to create a product line model that, merged with the margins, extends the range of possible values for the emulation (rundom number generators) performed by the <a href="#machinery-service">Machinery service</a>. That, in turn, will generate a certain percentage of values not belonging to the original range of values.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/usecase-manufacturing/diagrams/validator-productline-diagram.png" alt="validator productline diagram" width="100%">
</div>
</div>
<div class="paragraph">
<p>More details can be found in the <a href="https://github.com/qiot-project/qiot-manufacturing-factory-productline">dedicated repository</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="production-validator-service"><a class="anchor" href="#production-validator-service"></a>Production Validator service</h3>
<div class="imageblock">
<div class="content">
<img src="/assets/images/logo/logo-quarkus.png" alt="logo quarkus" width="10%">
</div>
</div>
<div class="paragraph">
<p>It&#8217;s implemented on top of the <a href="https://quarkus.io/">Quarkus</a> framework and runs in <a href="https://quarkus.io/guides/building-native-image">native mode</a> on a container environment.</p>
</div>
<div class="paragraph">
<p>The Validator service is responsible for the validation of the outcome of each and every production stage performed by the <a href="#machinery-service">Machinery service</a>.</p>
</div>
<div class="paragraph">
<p>It relies on the <a href="#product-line-service">Product-Line service</a> to gather the info related to the Product-line model and communicate asynchronously with the machineries through the <a href="#broker-service">Broker service</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/usecase-manufacturing/diagrams/validator-service-diagram.png" alt="validator service diagram" width="100%">
</div>
</div>
<div class="paragraph">
<p>More details can be found in the <a href="https://github.com/qiot-project/qiot-manufacturing-factory-productionvalidator">dedicated repository</a>.</p>
</div>
</div>
</div>
</div>
<h1 id="datacenter" class="sect0"><a class="anchor" href="#datacenter"></a>Datacenter</h1>
<div class="paragraph">
<p>The Datacenter layer of the Manufacturing use-case has been designed and implemented by the team and is made up of several services and business logic to manage, store, aggregate and retrieve data.</p>
</div>
<div class="sect1">
<h2 id="main-diagram-4"><a class="anchor" href="#main-diagram-4"></a>Main Diagram</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/usecase-manufacturing/architecture/datacenter.png" alt="datacenter" width="100%">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="platform-architecture"><a class="anchor" href="#platform-architecture"></a>Platform architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The infrastructure of the QIoT project must have flexible imprinting and should be easily scalable both horizontally and vertically.</p>
</div>
<div class="paragraph">
<p>To fulfill the scalability requirements a Cloud-based platform is needed.</p>
</div>
<div class="paragraph">
<p>A graphical representation of the basic Infrastructure Architecture:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/usecase-covid-19/datacenter-v2-infrastructure.png" alt="datacenter v2 infrastructure" width="100%">
</div>
</div>
<div class="paragraph">
<p>Based on the image above, here is the sizing of the infrastructure provisioned for the Openshift Container Platform:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OCP Control Plane (master nodes)</p>
<div class="ulist">
<ul>
<li>
<p>#Servers: 3</p>
</li>
<li>
<p>CPUs: 8</p>
</li>
<li>
<p>RAM: 24G</p>
</li>
</ul>
</div>
</li>
<li>
<p>OCP Worker Nodes:</p>
<div class="ulist">
<ul>
<li>
<p>#Servers: 3</p>
</li>
<li>
<p>CPUs: 12</p>
</li>
<li>
<p>RAM: 64GB</p>
</li>
</ul>
</div>
</li>
<li>
<p>Storage Server: provides storage functionality to the infrastructure to store data safely and consistently on the disk. There’s no urgent/compulsory need to add this component to the infrastructure architecture, at least at the early stage of the project, because the basic amount of storage provided by the cloud platform would definitely cover all the needs described.</p>
<div class="ulist">
<ul>
<li>
<p>Some additional storage will be needed in case of extended lifetime and participation in the project (i.e. lots more data arriving at the Data Hub). Anyway, just making use of the storage layer from the cloud provider of choice and installing Openshift Container Storage on top of it will guarantee horizontal scalability and data consistency all over the container platform out of the box.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Vertical scalability is guaranteed by the could platform.
Horizontal scalability is guaranteed by Openshift by using the auto-scaling feature embedded in the container platform.</p>
</div>
<div class="sect2">
<h3 id="red-hat-openshift-container-platform"><a class="anchor" href="#red-hat-openshift-container-platform"></a>Red Hat Openshift Container Platform</h3>
<div class="imageblock">
<div class="content">
<img src="/assets/images/logo/Logo-Red_Hat-OpenShift-A-Standard-RGB.png" alt="Logo Red Hat OpenShift A Standard RGB" width="20%">
</div>
</div>
<div class="paragraph">
<p>Red Hat OpenShift is the hybrid cloud platform of open possibility: powerful, so you can build anything and flexible, so it works anywhere.</p>
</div>
<div class="paragraph">
<p>Adopting the Openshift container platform made us save tons of hors implementing features and behaviors supposed to be home cooked, otherwise:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Native pipelines using Tekton</p>
</li>
<li>
<p>One-shot installation using Helm charts</p>
</li>
<li>
<p>2-day operations using Operator Framework</p>
</li>
<li>
<p>Container storage</p>
</li>
<li>
<p>Security and Isolation</p>
</li>
<li>
<p>Automate cluster scalability</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>More about Openshift Container Platform can be found <a href="https://www.openshift.com/learn/developer">here</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="software-infrastructure-components-2"><a class="anchor" href="#software-infrastructure-components-2"></a>Software infrastructure components</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="stream-service"><a class="anchor" href="#stream-service"></a>Stream service</h3>
<div class="imageblock">
<div class="content">
<img src="/assets/images/logo/logo-strimzi.png" alt="logo strimzi" width="20%">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/logo/logo-kafka.png" alt="logo kafka" width="20%">
</div>
</div>
<div class="paragraph">
<p>In the forecast of the need for receiving/handling a large number of concurrent messages, A-MQ Streams is the component of choice for streaming messages through the integration and the storage layers.</p>
</div>
<div class="paragraph">
<p>An internal streaming service guarantees scalability and reliability of the message flow management within the Datacenter business logic.</p>
</div>
<div class="paragraph">
<p>The Stream service topics serve a variety of functionalities and processes impacting the following workflows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Product-line</strong>: New Global product-line are delivered to the streaming service for asyncronous consumption by the factories. This workflow requires persistence and off-set management, both provided by the A-MQ Streams product;</p>
</li>
<li>
<p><strong>Telemetry</strong>: A-MQ perfectly fits into the canonical usecase of telemetry stream and management. Compared to the previous use-case implemented by the community, the team decided to go for a more structured and scalable approach based on a could-native product, rather that just relying on a communication protocol like <a href="https://mqtt.org/">MQTT protocol</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The implementation choices above make it easy to fine tune the connections, the scalability, the message flow, and retention separately.</p>
</div>
<div class="paragraph">
<p>This design makes it a lot easier to decouple the implementation details of the integration services responsible for offloading (consuming messages from) every topic and storing the values into the storage tier, improving horizontal scalability.</p>
</div>
<div class="paragraph">
<p>More about A-MQ Streams can be found <a href="https://developers.redhat.com/blog/2019/06/06/accessing-apache-kafka-in-strimzi-part-1-introduction/">here</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="timeseries-storage"><a class="anchor" href="#timeseries-storage"></a>Timeseries Storage</h3>
<div class="imageblock">
<div class="content">
<img src="/assets/images/logo/logo-influxdb.png" alt="logo influxdb" width="20%">
</div>
</div>
<div class="paragraph">
<p>Timeseries database engines are the technology of choice to store the telemetry coming from the IoT devices in an Edge Computing scenario.</p>
</div>
<div class="paragraph">
<p>For this use-case the team has picked up Influxdb, as it guarantees scalability, reliability and a level of performances not achievable using other competitors on the market.</p>
</div>
<div class="paragraph">
<p>Moreover, InfluxDB is the essential time series toolkit — dashboards, queries, tasks and agents all in one place.</p>
</div>
<div class="paragraph">
<p>As well as for the previous software infrastructure components used to receive and stream data, we have decided to go for a separation by telemetry-time.</p>
</div>
<div class="paragraph">
<p>The Timeseries Storage hosts the data relative to one telemetry only:</p>
</div>
<div class="paragraph">
<p>More about InfluxDB can be found <a href="https://www.influxdata.com/products/influxdb/">here</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="sql-storage-2"><a class="anchor" href="#sql-storage-2"></a>SQL Storage</h3>
<div class="imageblock">
<div class="content">
<img src="/assets/images/logo/logo-postgresql.png" alt="logo postgresql" width="10%">
</div>
</div>
<div class="paragraph">
<p>PostgreSQL is a powerful, open source object-relational database system with over 30 years of active development that has earned it a strong reputation for reliability, feature robustness, and performance.</p>
</div>
<div class="paragraph">
<p>The relational database engine is used to store non-timeseries data like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Factory-related data</p>
</li>
<li>
<p>Machinery-related data</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>More about PostgreSQL can be found <a href="https://www.postgresql.org/">here</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="nosql-storage-2"><a class="anchor" href="#nosql-storage-2"></a>NoSQL Storage</h3>
<div class="imageblock">
<div class="content">
<img src="/assets/images/logo/logo-mongodb.png" alt="logo mongodb" width="30%">
</div>
</div>
<div class="paragraph">
<p>MongoDB’s document data model naturally supports JSON and its expressive query language is simple for developers to learn and use. Functionality such as automatic failover, horizontal scaling, and the ability to assign data to a location are built-in.</p>
</div>
<div class="paragraph">
<p>The nosql database service is helpful when it comes to store, query and retrieve structured data sets like the json version of the <a href="https://raw.githubusercontent.com/qiot-project/qiot-manufacturing-datacenter-domainmodel/main/src/main/java/io/qiot/manufacturing/datacenter/commons/domain/productline/GlobalProductLineDTO.java">Global Product-line</a> model.</p>
</div>
</div>
<div class="sect2">
<h3 id="cert-manager-service"><a class="anchor" href="#cert-manager-service"></a>Cert-manager service</h3>
<div class="imageblock">
<div class="content">
<img src="/assets/images/logo/logo-cert-manager.png" alt="logo cert manager" width="10%">
</div>
</div>
<div class="paragraph">
<p>Cert-manager automates certificate management in cloud native environments and thus helped with the implementation of a dynamic certificate provisioning for edge devices</p>
</div>
<div class="paragraph">
<p>cert-manager builds on top of Kubernetes, introducing certificate authorities and certificates as first-class resource types in the Kubernetes API.</p>
</div>
<div class="paragraph">
<p>This makes it possible to provide 'certificates as a service' to developers working within your Kubernetes cluster.</p>
</div>
<div class="paragraph">
<p>Highlights</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provide easy to use tools to manage certificates.</p>
</li>
<li>
<p>A standardised API for interacting with multiple certificate authorities (CAs).</p>
</li>
<li>
<p>Gives security teams the confidence to allow developers to self-server certificates.</p>
</li>
<li>
<p>Support for ACME (Let&#8217;s Encrypt), HashiCorp Vault, Venafi, self signed and internal certificate authorities.</p>
</li>
<li>
<p>Extensible to support custom, internal or otherwise unsupported CAs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>More about out cert-manager implementation <a href="https://qiot-project.github.io/blog/qiot-cert-manager/">here</a></p>
</div>
<div class="paragraph">
<p>More about Cert-Manageranager can be found <a href="https://cert-manager.io/">here</a>.</p>
</div>
<div class="paragraph">
<p>Below you can find an overview of our distributed certificate authority implementation (using the Delecate CA described in the previous chapter)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/images/posts/usecase-manufacturing/issuer.png" alt="issuer" width="100%">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable Kubernetes Auth Engine in Vault.</p>
</li>
<li>
<p>Authorize Vault SA in k8s to Token Review.</p>
</li>
<li>
<p>Enable PKI engine.</p>
</li>
<li>
<p>Configure PKI role name in Vault.</p>
</li>
<li>
<p>Configure PKI policy in Vault.</p>
</li>
<li>
<p>Authorize/Binding issuer SA to use (policy) the PKI role.</p>
</li>
<li>
<p>Create Vault Issuer in app namespace with issuer SA.</p>
</li>
<li>
<p>Cert Manager validates the credentials of the issuer against Vault.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="business-logic-implementations"><a class="anchor" href="#business-logic-implementations"></a>Business Logic implementations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Datacenter business logic is built on top of Quarkus framework. All the services run natively on top of the container technology and benefit from the features from the Serverless architecture.</p>
</div>
<div class="paragraph">
<p>A separate discussion must be done for the Dashboard, which exposes diagrams based on the telemetry coming from the measurement stations and in implemented on top of RedHat build of Node.js</p>
</div>
<div class="sect2">
<h3 id="registration-service"><a class="anchor" href="#registration-service"></a>Registration service</h3>
<div class="imageblock">
<div class="content">
<img src="/assets/images/logo/logo-quarkus.png" alt="logo quarkus" width="10%">
</div>
</div>
<div class="paragraph">
<p>It&#8217;s implemented on top of the <a href="https://quarkus.io/">Quarkus</a> framework and runs in <a href="https://quarkus.io/guides/building-native-image">native mode</a> on a container environment.</p>
</div>
<div class="paragraph">
<p>It&#8217;s responsible for the provisioning and maintainance of the certificates used by services to connect to the other layers of the architecture using the mutual authentication method.</p>
</div>
<div class="paragraph">
<p>The main goal of the registration service is to implement a façade between the <a href="#plant-manager-service">Plant Manager service</a> and the <a href="#cert-manager-service">Cert-manager service</a>. To achive this goal and to make the access to the service limited, the service is not exposed by the router.</p>
</div>
<div class="paragraph">
<p>The interaction between the registration service and the Cert-manmager service is supported by the <a href="https://developers.redhat.com/articles/2021/07/16/whats-new-fabric8-kubernetes-client-version-550#">fabric8 Kubernetes plugin</a></p>
</div>
<div class="paragraph">
<p>More details can be found in the <a href="https://github.com/qiot-project/qiot-manufacturing-datacenter-registration">dedicated repository</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="plant-manager-service"><a class="anchor" href="#plant-manager-service"></a>Plant Manager service</h3>
<div class="imageblock">
<div class="content">
<img src="/assets/images/logo/logo-quarkus.png" alt="logo quarkus" width="10%">
</div>
</div>
<div class="paragraph">
<p>It&#8217;s implemented on top of the <a href="https://quarkus.io/">Quarkus</a> framework and runs in <a href="https://quarkus.io/guides/building-native-image">native mode</a> on a container environment.</p>
</div>
<div class="paragraph">
<p>It&#8217;s responsible for the management of the overall landscape:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Factories</strong> subscribe to the plant-manager and obtain a unique UUID and a trust store containing both the certificates for the connection to the datacenter and from the Machineries;</p>
</li>
<li>
<p><strong>Machineries</strong> subscribe to the facility manager service which, in turn, forwards the request to the plant manager service. They Obtain a unique UUID and a trust store containing the certificates to connect to the services exposed by the Factory layer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Landscape data are stored in the <a href="#sql-storage">SQL Storage</a> to take advantage of the CRUD operations.</p>
</div>
<div class="paragraph">
<p>Moreover, the service makes use of the 2nd level cache to speed up the read operations.</p>
</div>
<div class="paragraph">
<p>It exposes a rest API secured with mutual authentication. Details about the exposed endpoints are available in the <a href="#Specs">[Specs]</a> section</p>
</div>
<div class="paragraph">
<p>More details can be found in the <a href="https://github.com/qiot-project/qiot-manufacturing-datacenter-plant-manager">dedicated repository</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="global-product-line-service"><a class="anchor" href="#global-product-line-service"></a>Global Product-line service</h3>
<div class="imageblock">
<div class="content">
<img src="/assets/images/logo/logo-quarkus.png" alt="logo quarkus" width="10%">
</div>
</div>
<div class="paragraph">
<p>It&#8217;s implemented on top of the <a href="https://quarkus.io/">Quarkus</a> framework and runs in <a href="https://quarkus.io/guides/building-native-image">native mode</a> on a container environment.</p>
</div>
<div class="paragraph">
<p>The Global Product-line service is responsible for managing the Product-line models at the central level. The service can either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generate a new random <a href="https://raw.githubusercontent.com/qiot-project/qiot-manufacturing-datacenter-domainmodel/main/src/main/java/io/qiot/manufacturing/datacenter/commons/domain/productline/GlobalProductLineDTO.java">Global Product-line</a>;</p>
</li>
<li>
<p>Receive one from the GUI (not yet implemented) through REST API.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Product-line model is validated and stored into the <a href="#sql-storage">SQL Storage</a>.</p>
</div>
<div class="paragraph">
<p>More details can be found in the <a href="https://github.com/qiot-project/qiot-manufacturing-datacenter-productline">dedicated repository</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="event-collector-service"><a class="anchor" href="#event-collector-service"></a>Event Collector service</h3>
<div class="imageblock">
<div class="content">
<img src="/assets/images/logo/logo-quarkus.png" alt="logo quarkus" width="10%">
</div>
</div>
<div class="paragraph">
<p>It&#8217;s implemented on top of the <a href="https://quarkus.io/">Quarkus</a> framework and runs in <a href="https://quarkus.io/blog/runtime-performance/">JVM mode</a> on a container environment.</p>
</div>
<div class="paragraph">
<p>This service is responsible for consuming the telemetry coming from the <a href="#stream-service">Stream service</a>.The consumed paylod gets calidated, eventually decorated or adapted, and finally stored into the <a href="#timeseries-storage">Timeseries Storage</a>.</p>
</div>
<div class="paragraph">
<p>The team decided to go for a pure microservice implementation, dedicating one service to each and every telemetry type. Thus, all the services belonging to the event-collector family must extend some common abstract components that can be found into the <em>Commons</em> repositories (<a href="https://github.com/qiot-project/qiot-manufacturing-datacenter-utilities/tree/main/src/main/java/io/qiot/manufacturing/datacenter/commons/service/telemetry">qiot-manufacturing-datacenter-utilities</a>) and must be implemented adhering to the microservices atomicity, scalability and isolation recommended practices. Creating additional serviecs to handle different types of telemetries is left to the audience ;-)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Thanks to the Commons module it&#8217;s easy to extend the group of services to make them accept an additional telemetry type;</p>
</li>
<li>
<p>As the frequency of incoming messages per telemetry type can vary, scaling feature affects only one service in the group;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Due to the incompatibility of the <a href="https://github.com/influxdata/influxdb-client-java">Java Client for InfluxDB</a> with Quarkus native mode, the service is compiled using the standard java fast-jar mode.</p>
</div>
<div class="paragraph">
<p>More details can be found in the <a href="https://github.com/qiot-project/qiot-manufacturing-datacenter-event-collector">dedicated repository</a>.</p>
</div>
</div>
</div>
</div>

        <div id="share-bar">

    <hr>

    <h4>Share this:</h4>

    <div class="share-buttons">
        <a  href="https://www.facebook.com/sharer/sharer.php?u=/blog/usecase-manufacturing/"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
            title="Share on Facebook" >
            <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-facebook-f fa-stack-1x fa-inverse"></i>
              </span>
        </a>
        <a  href="https://twitter.com/intent/tweet?text=PoC Edge Manufacturing&url=/blog/usecase-manufacturing/"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
            title="Share on Twitter" >
            <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
        </a>
        <a  href="http://www.reddit.com/submit?url=/blog/usecase-manufacturing/"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;"
            title="Share on Reddit" >
            <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-reddit fa-stack-1x fa-inverse"></i>
              </span>
        </a>
        <a  href="https://www.linkedin.com/shareArticle?mini=true&url=/blog/usecase-manufacturing/&title=PoC Edge Manufacturing&summary=&source=QIoT project"
            onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;"
            title="Share on LinkedIn" >
            <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
              </span>
        </a>
        <a  href="mailto:?subject=PoC Edge Manufacturing&amp;body=Check out this site /blog/usecase-manufacturing/"
            title="Share via Email" >
            <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="far fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
        </a>
    </div>

</div>

        <hr>

<!--         <div class="clearfix"> -->
<!--            -->
<!--           <a class="btn btn-primary float-left" href="/blog/call-for-proposals-2021/" data-toggle="tooltip" data-placement="top" title="Call for proposals 2021">&larr; Previous<span class="d-none d-md-inline"> -->
<!--               Post</span></a> -->
<!--            -->
<!--            -->
<!--           <a class="btn btn-primary float-right" href="/blog/sno-on-nuc10/" data-toggle="tooltip" data-placement="top" title="Install Single Node Openshift on Intel® 10th gen NUC">Next<span class="d-none d-md-inline"> -->
<!--               Post</span> &rarr;</a> -->
<!--            -->

	  
	  
	  
	  

        <div class="clearfix">
          
          <a class="btn btn-primary float-left" href="/blog/usecase-covid-19/" data-toggle="tooltip" data-placement="top" title="PoC covid19">&larr; Previous<span class="d-none d-md-inline">
              Post</span></a>
          
          
          <a class="btn btn-primary float-right" href="/blog/usecase-retail/" data-toggle="tooltip" data-placement="top" title="Hackfest for Retail Use Case">Next<span class="d-none d-md-inline">
              Post</span> &rarr;</a>
          
        </div>

      </div>
    </div>
  </div>

  <!-- Footer -->

<hr>

<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-16 col-md-10 mx-auto">
        <ul class="list-inline text-center">
          
          <li class="list-inline-item">
            <a href="mailto:qiotproject@gmail.com">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="far fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://twitter.com/qiotproject">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          
          
          <li class="list-inline-item">
            <a href="https://github.com/qiot-project">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          
          <li class="list-inline-item">
            <a href="https://join.slack.com/t/https://join.slack.com/t/qiotproject/shared_invite/zt-nuajdyqf-NfQL0dcfCUjFSgoBNng11A">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-slack fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://groups.google.com/u/0/g/qiotproject/qiotproject">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-google fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://calendar.google.com/event?action=TEMPLATE&tmeid=dmFxMzFlZGkxOHVubDcyYm50bjdrcTJxYThfMjAyMTAzMjVUMTYwMDAwWiBxaW90cHJvamVjdEBt&tmsrc=qiotproject%40gmail.com&scp=ALL">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fas fa-calendar-plus fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="copyright text-muted"><i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a> | Copyright &copy;  2024</p>
      </div>
    </div>
  </div>
</footer>

  <script src="/assets/vendor/jquery/jquery.min.js"></script>
<script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/assets/vendor/startbootstrap-clean-blog/js/clean-blog.min.js"></script>

<script src="/assets/scripts.js"></script>




</body>

</html>
